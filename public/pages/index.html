<!DOCTYPE html>
<html>
<head>
	<title>Welcome to Hotels</title>

	<link rel="stylesheet" type="text/css" href="/styles/hotel_list.css">
</head>
<body>
	<h3 style="text-align: center;">Welcome to Hotels!</h3>

	<div class="hotels_list" data-establishmentid="374848">
		
		<div class="hotel_list_item">

			<div class="image_container" style="width: 100%;">
				<!-- <img src="https://i.t-rp.co.uk/ei/3/7/4/8/4/8/0_400_400.jpg" alt="Hotel Image" /> -->
			</div>

			<div class="title_and_price_container">
				
				<div class="title_container">
					<h3 style="margin-top: 0;"> Vienna International Dream Castle Hotel </h3>
				</div>
				<div class="price_container">
					<h3 style="margin-top: 0;"> 588 </h3>
				</div>
			</div>

			<div class="stars_container" >
				4
			</div>

		</div>

		<div class="hotel_list_item">

			<div class="image_container" style="width: 100%;">
				<!-- <img src="https://i.t-rp.co.uk/ei/3/7/4/3/1/7/0_400_400.jpg" alt="Hotel Image" /> -->
			</div>

			<div class="title_and_price_container">
				
				<div class="title_container">
					<h3 style="margin-top: 0;"> Vienna International Dream Castle Hotel </h3>
				</div>
				<div class="price_container">
					<h3 style="margin-top: 0;"> 588 </h3>
				</div>
			</div>

			<div class="stars_container" >
				4
			</div>

		</div>

		<div class="hotel_list_item">

			<div class="image_container" style="width: 100%;">
				<!-- <img src="https://i.t-rp.co.uk/ei/1/1/8/1/6/4/0_400_400.jpg" alt="Hotel Image" /> -->
			</div>

			<div class="title_and_price_container">
				
				<div class="title_container">
					<h3 style="margin-top: 0;"> Vienna International Dream Castle Hotel </h3>
				</div>
				<div class="price_container">
					<h3 style="margin-top: 0;"> 588 </h3>
				</div>
			</div>

			<div class="stars_container" >
				4
			</div>

		</div>

	</div>

	<script type="text/javascript">

		function fetchDataBlocking(url) {
			console.log("fetchDataBlocking called!");
			return new Promise(function(resolve, reject) {
				
				var xhr = new XMLHttpRequest();

				xhr.onreadystatechange = function() {

					if (xhr.readyState === 4) {

						if(xhr.status !== 200)
							reject("Some error occured!" + xhr.responseText);

						try {
							resolve(JSON.parse(xhr.responseText));
						} catch(exception) {

							resolve(xhr.responseText);
						}
					}
				}

				xhr.onerror = function() {
					reject("Some error occured while requesting the database");
				}

				xhr.onabort = function() {
					reject("The transfer has been canceled by the user.")
				}

				xhr.open("GET", url, true);
				xhr.send();
			});
		}

		function initDatabase() {

			console.log("initDatabase called!");
			// var xhr = new XMLHttpRequest();
			// var url = "/initDatabase";

			// xhr.open("GET", url, true);
			// xhr.send();
		}

		function fetchDatabase() {

			
		}


		fetchDataBlocking("/api/hotels")
		.then(function(response) {

			if(!response.message.length) {
				fetchDataBlocking("/initDatabase")
				.then(response => {
					console.log("initDatabase finished!")
					console.log(response);
				})
				.catch(error => {
					console.error(error);
				})
			} else {

				console.log(response.message);
				console.log(response.message[0]);
			}
		})
		.catch(function(error) {
			console.error(error);
		});

	</script>
</body>
</html>